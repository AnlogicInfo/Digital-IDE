"use strict";

const fs     = require("fs");
const fspath = require("path");

const prjs   = require("../operation/prjs")

let fsWait = false;

function momitor (path, opeParam, callback) {
    let extensions = [".vhd",".vhdl",".vho",".vht",".v",".V",".vh",".vl",".sv",".SV"];
    fs.watch(path, { recursive : true }, function (event, fileName) {
        if (fileName) {
            if (fsWait) return;
            fsWait = setTimeout(() => {
              fsWait = false;
            }, 50);
            console.log(event);
            console.log(fileName);
            if (fileName.indexOf("property.json") != -1) {
                prjs.getOpeParam(opeParam.rootPath, opeParam);
                prjs.refreshPrjFolder(opeParam);
                prjs.refreshPrjInfo(opeParam);
            }
            // if (fs.statSync(fileName).isDirectory()) {
            //     callback();
            // } else {
            //     extensions.forEach(extname => {
            //         if (fspath.extname(fileName).toLowerCase() === extname) {
            //             callback();
            //         }
            //     });
            // }
        }
    });
}
exports.momitor = momitor;