"use strict";

const fs     = require('fs');
const vscode = require('vscode');
const vhd2vl = require("./translate/vhd2vl");

function vhdl2vlog(path) {
    vhd2vl().then((Module) => {
        let content = fs.readFileSync(path, "utf-8");
        let status = Module.ccall('vhdlParse', '', ['string'], [content]);
        if (status) {
            content = Module.ccall('getVlog', 'string', ['string'], []);
            // Create untitled file
            const newFileUri = vscode.Uri.file(`${path}.v`).with({ scheme: 'verilog' });
            vscode.workspace.openTextDocument(newFileUri);

            // Fill in initial content
            const edit = new vscode.WorkspaceEdit();
            edit.insert(newFileUri, new vscode.Position(0, 0), content);
            vscode.workspace.applyEdit(edit);

            // Actually show the editor
            vscode.commands.executeCommand('vscode.open', newFileUri);
        } else {
            return null;
        }
    });
}
exports.vhdl2vlog = vhdl2vlog;
